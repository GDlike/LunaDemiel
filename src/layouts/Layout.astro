---
import { ClientRouter } from "astro:transitions";
import Fireflies from "../components/Fireflies.astro";

interface Props {
  title: string;
  description?: string;
  image?: string;
}

const { title, description, image } = Astro.props;

const pathname = new URL(Astro.url).pathname;
const currentPath = pathname.slice(1).replace(/\/$/, "");
const canonical = new URL(Astro.url).toString();

// Defaults
const metaDescription =
  description ??
  "Guía y ruta de nuestra luna de miel por Indonesia: Bali, Ubud, Uluwatu, Seminyak, Gili y Lombok.";
const ogImage = image ?? "/og.jpg";
---

<!doctype html>
<html lang="es" class="scroll-smooth bg-[#0a0a0a]">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>

    <meta name="description" content={metaDescription} />
    <link rel="canonical" href={canonical} />

    <!-- Open Graph -->
    <meta property="og:locale" content="es_ES" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={metaDescription} />
    <meta property="og:url" content={canonical} />
    <meta property="og:image" content={ogImage} />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={metaDescription} />
    <meta name="twitter:image" content={ogImage} />

    <ClientRouter />

    <!-- Icons / UI -->
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <meta name="theme-color" content="#0a0a0a" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&display=swap"
      rel="stylesheet"
    />
  </head>

  <body
    class="text-slate-200 antialiased selection:bg-amber-500/30 selection:text-amber-200 relative"
  >
    <!-- FX GLOBAL: ahora siempre sale, sin depender de slots -->
    <Fireflies />

    <nav class="fixed top-6 left-0 w-full z-50 flex justify-center px-4">
      <div
        class="flex flex-wrap items-center justify-between gap-2 md:gap-8 bg-black/60 backdrop-blur-xl border border-white/10 rounded-3xl md:rounded-full pl-3 pr-4 py-2 shadow-2xl max-w-[98vw]"
      >
        <a
          href="/"
          class="flex items-center gap-1.5 px-3 py-1.5 bg-white/5 rounded-full border border-white/5 hover:bg-amber-500/20 hover:border-amber-500/30 transition-all shrink-0 group"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="text-amber-500 group-hover:scale-110 transition-transform"
          >
            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            <polyline points="9 22 9 12 15 12 15 22" />
          </svg>
          <span class="font-[900] text-sm md:text-base tracking-tighter text-white">
            B&S <span class="text-amber-500 font-light">2026</span>
          </span>
        </a>

        <ul
          class="flex flex-wrap items-center justify-center gap-1 text-[11px] md:text-xs font-[900] text-zinc-400 uppercase tracking-wider"
        >
          <li>
            <a href="/ruta" class={`nav-link ${currentPath === "ruta" ? "active" : ""}`}>Ruta</a>
          </li>
          <li>
            <a href="/sabores" class={`nav-link ${currentPath === "sabores" ? "active" : ""}`}>Sabores</a>
          </li>
          <li>
            <a href="/cultura" class={`nav-link ${currentPath === "cultura" ? "active" : ""}`}>Cultura</a>
          </li>
          <li>
            <a href="/mapa" class={`nav-link ${currentPath === "mapa" ? "active" : ""}`}>Mapa</a>
          </li>
          <li>
            <a href="/galeria" class={`nav-link ${currentPath === "galeria" ? "active" : ""}`}>Fotos</a>
          </li>
          <li>
            <a href="/guia" class={`nav-link ${currentPath === "guia" ? "active" : ""}`}>Guía</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="fixed bottom-6 left-6 z-50 flex flex-col gap-3 items-center" transition:persist>
      <div id="gato-container" class="opacity-0 transition-opacity duration-1000 pointer-events-none -mb-1">
        <img src="/gato.gif" width="80" alt="Gato Bali" class="rounded-lg shadow-xl" />
      </div>

      <button
        id="music-btn"
        type="button"
        aria-label="Reproducir o pausar música"
        aria-pressed="false"
        class="flex items-center gap-3 bg-black/60 backdrop-blur-md border border-white/10 px-4 py-2 rounded-full hover:bg-amber-500/20 hover:border-amber-500/40 transition-all group shadow-lg"
      >
        <div id="icon-play" class="text-amber-500 group-hover:scale-110 transition-transform">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="5 3 19 12 5 21 5 3" />
          </svg>
        </div>

        <div id="icon-pause" class="hidden text-amber-500 group-hover:scale-110 transition-transform">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <rect x="6" y="4" width="4" height="16" />
            <rect x="14" y="4" width="4" height="16" />
          </svg>
        </div>

        <span class="font-black text-white text-[10px] uppercase tracking-[0.2em]">Bali Mood</span>
      </button>

      <audio id="bali-audio" loop src="/baiana.mp3"></audio>

      <a
        href="https://borjaysusan.com"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-3 bg-amber-500/10 backdrop-blur-md border border-amber-500/20 px-4 py-2 rounded-full hover:bg-amber-500 hover:border-amber-400 hover:scale-105 transition-all shadow-[0_0_20px_rgba(245,158,11,0.2)] group w-full justify-center text-center"
      >
        <span class="font-black text-white text-[10px] uppercase tracking-[0.2em]">Web Boda</span>
      </a>
    </div>

    <div class="fixed bottom-6 right-6 z-50 flex flex-col gap-3">
      <a
        href="https://www.instagram.com/hanzohiro/"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-3 bg-black/60 backdrop-blur-md border border-white/10 px-4 py-2 rounded-full hover:bg-amber-600 hover:border-amber-500 hover:scale-105 transition-all shadow-lg group"
      >
        <span class="font-black text-white text-[10px]">@HanzoHiro</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-amber-500 group-hover:text-white">
          <rect width="20" height="20" x="2" y="2" rx="5" ry="5" />
          <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" />
          <line x1="17.5" x2="17.51" y1="6.5" y2="6.5" />
        </svg>
      </a>

      <a
        href="https://www.instagram.com/susan.jtm/"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-3 bg-black/60 backdrop-blur-md border border-white/10 px-4 py-2 rounded-full hover:bg-amber-600 hover:border-amber-500 hover:scale-105 transition-all shadow-lg group"
      >
        <span class="font-black text-white text-[10px]">@susan.jtm</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-amber-500 group-hover:text-white">
          <rect width="20" height="20" x="2" y="2" rx="5" ry="5" />
          <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" />
          <line x1="17.5" x2="17.51" y1="6.5" y2="6.5" />
        </svg>
      </a>
    </div>

    <!-- HERO VA AQUÍ -->
    <slot name="hero" />

    <!-- MAIN -->
    <main class="max-w-7xl mx-auto px-4 pt-0 -mt-16 md:-mt-32 pb-20 relative z-10">
      <slot />
    </main>

    <script is:inline>
      function setupMusic() {
        const btn = document.getElementById('music-btn');
        const audio = document.getElementById('bali-audio');
        const play = document.getElementById('icon-play');
        const pause = document.getElementById('icon-pause');
        const gato = document.getElementById('gato-container');

        if (!btn || !audio || !play || !pause || !gato) return;

        btn.onclick = () => {
          if (audio.paused) {
            audio.play();
            play.classList.add('hidden');
            pause.classList.remove('hidden');
            btn.classList.add('bg-amber-500/20', 'border-amber-500/50');
            btn.setAttribute('aria-pressed', 'true');

            gato.classList.remove('opacity-0');
            gato.classList.add('opacity-100');

            setTimeout(() => {
              gato.classList.remove('opacity-100');
              gato.classList.add('opacity-0');
            }, 8000);
          } else {
            audio.pause();
            play.classList.remove('hidden');
            pause.classList.add('hidden');
            btn.classList.remove('bg-amber-500/20', 'border-amber-500/50');
            btn.setAttribute('aria-pressed', 'false');
          }
        };
      }

      setupMusic();
      document.addEventListener('astro:after-swap', setupMusic);
    </script>
  </body>
</html>

<style is:global>
  html { font-family: 'Outfit', sans-serif; }

  .nav-link {
    position: relative;
    padding: 0.5rem 0.75rem;
    transition: all 0.4s ease;
    border-radius: 9999px;
    color: #9ca3af;
  }

  @media (max-width: 420px) {
    .nav-link { padding: 0.4rem 0.55rem; }
  }

  .nav-link.active {
    color: white;
    font-weight: 900;
    text-shadow: 0 0 15px rgba(245, 158, 11, 0.5);
  }

  .nav-link.active::after {
    content: '';
    position: absolute;
    inset: -2px;
    background: radial-gradient(circle, rgba(245, 158, 11, 0.25) 0%, transparent 75%);
    border-radius: 9999px;
    z-index: -1;
    animation: pulse-aura 2.5s infinite;
  }

  @keyframes pulse-aura {
    0%, 100% { transform: scale(1); opacity: 0.4; }
    50% { transform: scale(1.1); opacity: 0.7; }
  }
</style>
