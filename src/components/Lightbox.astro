---
// Componente Lightbox para galería de imágenes
---

<div id="lightbox" class="fixed inset-0 z-[9999] hidden items-center justify-center bg-black/95 backdrop-blur-md" role="dialog" aria-modal="true" aria-label="Vista ampliada de imagen">
  <button
    id="lightbox-close"
    aria-label="Cerrar vista ampliada"
    class="absolute top-4 right-4 z-10 w-12 h-12 bg-white/10 hover:bg-white/20 border border-white/20 rounded-full flex items-center justify-center transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-500"
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-white">
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  </button>

  <div class="relative max-w-7xl max-h-[90vh] mx-4 flex items-center justify-center">
    <img id="lightbox-image" src="" alt="" class="max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl" />
  </div>

  <button
    id="lightbox-prev"
    aria-label="Imagen anterior"
    class="absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/10 hover:bg-white/20 border border-white/20 rounded-full flex items-center justify-center transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-500"
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-white">
      <polyline points="15 18 9 12 15 6"></polyline>
    </svg>
  </button>

  <button
    id="lightbox-next"
    aria-label="Imagen siguiente"
    class="absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/10 hover:bg-white/20 border border-white/20 rounded-full flex items-center justify-center transition-all focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-500"
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-white">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </button>
</div>

<script>
  let currentImages = [];
  let currentIndex = 0;

  function initLightbox() {
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightbox-image');
    const lightboxClose = document.getElementById('lightbox-close');
    const lightboxPrev = document.getElementById('lightbox-prev');
    const lightboxNext = document.getElementById('lightbox-next');

    if (!lightbox || !lightboxImage || !lightboxClose) return;

    function openLightbox(images, index) {
      currentImages = images;
      currentIndex = index;
      lightboxImage.src = currentImages[currentIndex].src;
      lightboxImage.alt = currentImages[currentIndex].alt || '';
      lightbox.classList.remove('hidden');
      lightbox.classList.add('flex');
      document.body.style.overflow = 'hidden'; // Prevenir scroll del body
      
      // Focus en el botón de cerrar para accesibilidad
      setTimeout(() => lightboxClose.focus(), 100);
    }

    function closeLightbox() {
      lightbox.classList.add('hidden');
      lightbox.classList.remove('flex');
      document.body.style.overflow = '';
      currentImages = [];
      currentIndex = 0;
    }

    function showNext() {
      if (currentImages.length === 0) return;
      currentIndex = (currentIndex + 1) % currentImages.length;
      lightboxImage.src = currentImages[currentIndex].src;
      lightboxImage.alt = currentImages[currentIndex].alt || '';
    }

    function showPrev() {
      if (currentImages.length === 0) return;
      currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
      lightboxImage.src = currentImages[currentIndex].src;
      lightboxImage.alt = currentImages[currentIndex].alt || '';
    }

    // Event listeners
    lightboxClose.addEventListener('click', closeLightbox);
    lightboxPrev.addEventListener('click', showPrev);
    lightboxNext.addEventListener('click', showNext);

    // Cerrar con ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !lightbox.classList.contains('hidden')) {
        closeLightbox();
      }
      if (e.key === 'ArrowRight' && !lightbox.classList.contains('hidden')) {
        showNext();
      }
      if (e.key === 'ArrowLeft' && !lightbox.classList.contains('hidden')) {
        showPrev();
      }
    });

    // Cerrar al hacer click fuera de la imagen
    lightbox.addEventListener('click', (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });

    // Inicializar imágenes con data-lightbox
    function setupLightboxImages() {
      const images = Array.from(document.querySelectorAll('img[data-lightbox]'));
      if (images.length === 0) return;

      const imageData = images.map(img => ({
        src: img.dataset.lightboxSrc || img.src,
        alt: img.alt || ''
      }));

      images.forEach((img, index) => {
        img.style.cursor = 'pointer';
        img.addEventListener('click', () => {
          openLightbox(imageData, index);
        });
      });
    }

    setupLightboxImages();
  }

  // Inicializar en carga y navegación Astro
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLightbox);
  } else {
    initLightbox();
  }
  document.addEventListener('astro:page-load', initLightbox);
</script>
