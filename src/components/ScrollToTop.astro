---
// Componente para botón "Volver arriba" que aparece al hacer scroll
---

<button
  id="scroll-to-top"
  aria-label="Volver arriba"
  class="
    fixed bottom-24 right-6 z-40
    w-12 h-12 md:w-14 md:h-14
    bg-black/80 md:bg-black/60
    backdrop-blur-md
    border border-white/10
    rounded-full
    flex items-center justify-center
    opacity-0 invisible
    transition-all duration-300
    hover:bg-amber-500/20 hover:border-amber-500/40 hover:scale-110
    focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-500/60 focus-visible:ring-offset-2 focus-visible:ring-offset-black
    shadow-lg
    group
  "
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2.5"
    stroke-linecap="round"
    stroke-linejoin="round"
    class="text-amber-500 group-hover:text-amber-400 transition-colors"
  >
    <path d="m18 15-6-6-6 6" />
  </svg>
</button>

<script>
  function setupScrollToTop() {
    const btn = document.getElementById('scroll-to-top');
    if (!btn) return;

    // Mostrar/ocultar según scroll
    function handleScroll() {
      if (window.scrollY > 400) {
        btn.classList.remove('opacity-0', 'invisible');
        btn.classList.add('opacity-100', 'visible');
      } else {
        btn.classList.add('opacity-0', 'invisible');
        btn.classList.remove('opacity-100', 'visible');
      }
    }

    // Click: scroll suave hacia arriba
    btn.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
      // Focus en el logo/nav después del scroll
      setTimeout(() => {
        const logo = document.querySelector('nav a[href="/"]');
        if (logo) logo.focus();
      }, 500);
    });

    // Throttle del scroll para performance
    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    }, { passive: true });

    // Check inicial
    handleScroll();
  }

  // Inicializar en carga y navegación Astro
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupScrollToTop);
  } else {
    setupScrollToTop();
  }
  document.addEventListener('astro:page-load', setupScrollToTop);
</script>
